<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN"
          "http://www.w3.org/TR/html4/strict.dtd">
<html>

<head>
  <title>Setting up a Workspace</title>
  <style>@import url(style.css);</style>
</head>

<body class="jdocu_main">
<script type="text/javascript">
parent.frames['toc'].d.openTo(20, true);
</script>
<a name="label32"></a><p class="jdocu_navbarp"><span class="jdocu_navbar"><a class="jdocu" href="topic5.html">Previous</a> - <a class="jdocu" href="topic4.html">Up</a> - <a class="jdocu" href="topic7.html">Next</a></span></p>
<h3 class="jdocu">3.2&nbsp;&nbsp;&nbsp;Setting up a Workspace</h3 class="jdocu">


<a name="label33"></a>
<a name="label34"></a>
<a name="label35"></a>
<a name="label36"></a>
<a name="label37"></a>
<a name="label38"></a>
<a name="label39"></a>
<a name="label40"></a>
<p>
<hr class="jdocu_note"><b>Note:</b> The workspace makefiles require <a name="label41">GNU make</a>
(a.k.a. <tt><a name="label42">gmake</a></tt>), version 3.77 or later, which is
available from <a class="jdocu" href="ftp://ftp.gnu.org/gnu/make" target="_top">ftp://ftp.gnu.org/gnu/make</a>. In the following
text, when you're asked to run <tt>gmake</tt>, this refers to running the
GNU make binary, which may be called <tt>gmake</tt> or <tt>make</tt>,
depending on your installation.  <hr class="jdocu_note">
<p>
A workspace is a directory which contains all necessary user-specific files
needed to run Simics and develop modules. Setting up a workspace is done
using the <tt>workspace-setup</tt> scripts, like this:
<p>
<pre class="jdocu_small" style="color: black">
$ <b>[simics]/bin/workspace-setup.bat $HOME/my-simics-workspace</b>
</pre>
<p>
where <i>[simics]</i> is the location of the Simics-installation. The
script can also be invoked in a <tt>cmd.exe</tt> command prompt window. The
<tt>.bat</tt> extension is necessary if the script is invoked in a Cygwin
shell; Cygwin does not automatically append <tt>.bat</tt> as
<tt>cmd.exe</tt> does.
<p>
<hr class="jdocu_note"><b>Note:</b> The workspace setup script does <b>not</b> rely on the
<tt>configure</tt> being run in the installed Simics.<hr class="jdocu_note">
<p>
The script will create a workspace directory with the following contents:
<p>
<table>
<tr><td class="jdocu_noborder"><tt>simics</tt></td><td class="jdocu_noborder"><tt>simics-eclipse</tt></td><td class="jdocu_noborder"><tt>GNUmakefile</tt></td></tr>
<tr><td class="jdocu_noborder"><tt>compiler.mk</tt></td><td class="jdocu_noborder"><tt>config.mk</tt></td><td class="jdocu_noborder"><tt>.workspace-properties</tt></td></tr>
<tr><td class="jdocu_noborder"><tt>modules/</tt></td><td class="jdocu_noborder"><tt>targets/</tt></td><td class="jdocu_noborder"><tt></tt><em>host</em><tt>/</tt></td></tr>
</table>
<p>
<dl><dt><b><tt>simics</tt></b></dt><dd>Starts Simics in command-line mode.</dd><dt><b><tt>simics-eclipse</tt></b></dt><dd>Starts Simics with the Eclipse
frontend.</dd><dt><b><tt>GNUmakefile</tt></b></dt><dd>Makefile to build all modules
under the <tt>modules</tt> directory.  The file is called
<tt>GNUmakefile</tt> to signify that it requires GNU make. Do not
edit this file, instead you may create a file called
<tt>config-user.mk</tt>, where you can override settings in
<tt>config.mk</tt>.</dd><dt><b><tt>compiler.mk</tt></b></dt><dd>Make file that selects the C compiler
to use by setting the <i>CC</i> variable. A matching C++ compiler
will be searched for by <tt>config.mk</tt> in the same path as
<i>CC</i> if <i>CXX</i> is not set. The <tt>compiler.mk</tt>
file will not be overwritten when the workspace is updated.</dd><dt><b><tt>config.mk</tt></b></dt><dd>Includes <tt>[simics]/config/config.mk</tt> that contains default
definition of make flags for different compilers, such as <i>CFLAGS</i>.
Do not edit this file; override variables in <tt>config-user.mk</tt>
instead.</dd><dt><b><tt>config-user.mk</tt></b></dt><dd>Optional file that may contain user
defined make variables overriding the ones in
<tt>[simics]/config/config.mk</tt>.</dd><dt><b><tt>module-user.mk</tt></b></dt><dd>Optional file that may contain user
defined make targets and variables overriding the ones in
<tt>[simics]/config/module.mk</tt>.</dd><dt><b><tt>modules/</tt></b></dt><dd>Contains user-developed modules. The
default target in <tt>GNUmakefile</tt> builds all modules in the
<tt>modules</tt> directory.</dd><dt><b><tt>targets/</tt></b></dt><dd>Contains some pre-configured machines,
to be used as examples.</dd><dt><b>&lt;host&gt;/</b></dt><dd>
The build working directory, which is named after the host type, for example
<tt>x86-linux</tt>, <tt>v9-sol8-64</tt>, <tt>amd64-linux</tt> or
<tt>x86-win32</tt>. When a module is compiled, any intermediate build
files, like dependency and object files (<tt>.d</tt> <tt>.o</tt>) are generated
in the <tt>&lt;host&gt;/obj/modules/&lt;module&gt;/</tt> directory. The resulting
module file is placed in <tt>&lt;host&gt;/lib/</tt>, and the Python command
file for the module is copied to the <tt>&lt;host/lib/python/</tt>
directory.
</dd><dt><b><tt>.workspace-properties</tt></b></dt><dd>For internal use.</dd></dl>
<p>
When the workspace has been created, you may type <b>make</b> (or
possibly <b>gmake</b>) to build all the modules, or <b>./simics</b>
to start Simics.
<p>
In order to rebuild all modules, type <b>make clean</b>, followed by
<b>make</b>. In order to rebuild just a single module, type <b>make
clean-&lt;modulename&gt;</b>, for example:
<p>
<pre class="jdocu_small" style="color: black">
$ <b>make</b> # builds all modules
$ <b>make clean-mymodule</b> # removes all objectfiles for "mymodule"
$ <b>make mymodule</b> # builds "mymodule"
</pre>
<p>
The <tt>clean</tt> targets only remove object files and similar intermediates
for the module not needed when running. To remove the actual module files as
well, use <tt>make clobber</tt> or <tt>make clobber&lt;modulename&gt;</tt>.
<p>
<a name="label43"></a><h4 class="jdocu">3.2.1&nbsp;&nbsp;&nbsp;Workspace setup script invocation</h4 class="jdocu">


<a name="label44"></a>
<a name="label45"></a>
<p>
The workspace setup script is used to <i>create</i> and <i>upgrade</i>
workspaces. It can also create module skeletons to start with when
writing new devices.
<p>
The setup script is located in the <tt>bin</tt> subdirectory of the
Simics installation, and is invoked like this:
<p>
<pre class="jdocu_small" style="color: black">
$ <b>[simics]/bin/workspace-setup [options] [workspace]</b>
</pre>
<p>
You may put the <tt>[simics]/bin</tt> directory in your <i>PATH</i>
variable, and invoke the script directly.
<p>
<pre class="jdocu_small" style="color: black">
$ <b>workspace-setup [options] [workspace]</b>
</pre>
<p>
<b>Option summary</b> (can also be shown using the <i>--help</i> option):
<p>
<dl><dt><b><i>-v, --version</i></b></dt><dd>Prints information about Simics (version, installation directory).</dd><dt><b><i>-n, --dry-run</i></b></dt><dd>Execute normally, but do change or create any files.</dd><dt><b><i>-q, --quiet</i></b></dt><dd>Do not print any info about the actions taken by the script.</dd><dt><b><i>--force</i></b></dt><dd>Force using a non-empty directory as workspace. Note: even with this
option, modules in the module sub-directory will <b>not</b> be overwritten.</dd><dt><b><i>--device=MODULE_NAME</i></b></dt><dd>Generate skeleton code for a device, suitable to use as a starting
point for implementing your own device. The default implementation
language is DML. See the <i>--c-device</i> and
<i>--py-device</i> options for creating devices using other
languages. If the device already exists, this option is ignored. To
recreate the skeleton, remove the device directory.</dd><dt><b><i>--c-device=MODULE_NAME</i></b></dt><dd>Similar to <i>--device</i>, but creates a device using C
instead of DML.</dd><dt><b><i>--py-device=MODULE_NAME</i></b></dt><dd>Similar to <i>--device</i>, but creates a device using Python
instead of DML.</dd><dt><b><i>--copy-device=MODULE_NAME</i></b></dt><dd>Copies the source for a sample device/module into the
workspace. The files will be copied from the Simics installation. If
the device already exist in your workspace, you must manually delete
it first.</dd></dl>
<p>
<a name="label46"></a><h4 class="jdocu">3.2.2&nbsp;&nbsp;&nbsp;Updating workspaces</h4 class="jdocu">


<a name="label47"></a>
<a name="label48"></a>
<p>
To upgrade your workspace to a new Simics version, run the script again with
no arguments.
<p>
<pre class="jdocu_small" style="color: black">
$ <b>cd $HOME/my-simics-workspace</b>
$ <b>[path-to-new-simics]/bin/workspace-setup</b>
</pre>
<p>
It will do the necessary updates in the workspace, but leave the
user-modifiable files intact. (Modified files that need to be overwritten are
saved in backup versions with the extension "<tt>.~N~</tt>" (Unix) or
"<tt>~N~.backup</tt>" (Windows), where N is the first free number.)
<p>

<p>
<p class="jdocu_navbarp"><span class="jdocu_navbar"><a class="jdocu" href="topic5.html">Previous</a> - <a class="jdocu" href="topic4.html">Up</a> - <a class="jdocu" href="topic7.html">Next</a></span></p>
</body>
</html>
